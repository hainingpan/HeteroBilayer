function [val,vec,H]=energyTMD(kx,ky,params)
%energy at (kx,ky)
DeltaTmat=params.DeltaTmat;
DeltaTTmat=params.DeltaTTmat;
Deltabmat=params.Deltabmat;
Deltatmat=params.Deltatmat;
Vz_b=params.Vz_b;
Vz_t=params.Vz_t;
m_b=params.m_b;
m_t=params.m_t;
kb=params.kb;
kt=params.kt;
bM1=params.bM1;
bM2=params.bM2;
h1index=params.h1index;
h2index=params.h2index;
t=params.valley;
kblist=t*[kx,ky]-kb+t*h1index(:)*bM1+t*h2index(:)*bM2;
ktlist=t*[kx,ky]-kt+t*h1index(:)*bM1+t*h2index(:)*bM2;
H11=-1/(2*m_b)*diag(dot(kblist,kblist,2))+Deltabmat+Vz_b*eye(length(Deltabmat));
H22=-1/(2*m_t)*diag(dot(ktlist,ktlist,2))+Deltatmat+Vz_t*eye(length(Deltabmat));
H12=DeltaTmat;
H21=DeltaTTmat;
H=[H11,H12;H21,H22];
[vec,val]=eig(H);
val=diag(val);
val=val(end:-1:1);
vec=vec(:,end:-1:1);
end